[package]
versioned_files = ["Cargo.toml"]
changelog = "CHANGELOG.md"

[[workflows]]
name = "changeset"

[[workflows.steps]]
type = "CreateChangeFile"

[[workflows]]
name = "prepare-release"

[[workflows.steps]]
type = "Command"
command = "git switch -c $RELEASE_BRANCH"
shell = true

[[workflows.steps]]
type = "Command"
command = "cargo set-version --workspace $version"
variables = { "$version" = "Version" }

[[workflows.steps]]
type = "PrepareRelease"

[[workflows.steps]]
type = "Command"
command = "git commit -m \"ci(bump): prepare release $version\""
variables = { "version" = "Version" }

[[workflows.steps]]
type = "Command"
command = "git push --force --set-upstream origin $RELEASE_BRANCH"
shell = true

[[workflows.steps]]
type = "CreatePullRequest"
base = "main"

[workflows.steps.title]
template = "chore: prepare release $version"
variables = { "$version" = "Version" }

[workflows.steps.body]
template = "This PR was created by Knope. Merging it will create a new release\n\n$changelog"
variables = { "$changelog" = "ChangelogEntry" }

[github]
owner = "pedronauck"
repo = "rust-test"
